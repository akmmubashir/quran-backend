// Prisma Schema for Quran Backend API
// 
// SETUP INSTRUCTIONS:
// 1. Ensure PostgreSQL is running and create a database: CREATE DATABASE quran;
// 2. Update DATABASE_URL in .env file with your credentials
// 3. Generate Prisma Client: npx prisma generate
// 4. Run migrations: npx prisma migrate deploy
// 5. Seed database: npm run prisma:seed
//
// DEVELOPMENT WORKFLOW:
// - After modifying this schema, run: npx prisma migrate dev --name description
// - This will create a migration and regenerate the client automatically
// - If client seems out of sync, run: npx prisma generate
//
// USEFUL COMMANDS:
// - npx prisma studio          # Open visual database editor
// - npx prisma db pull         # Pull schema from existing database
// - npx prisma migrate reset   # Reset database and re-run all migrations
// - npx prisma format          # Format this schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")  // Set in .env: postgresql://user:pass@localhost:5432/quran
}

model Surah {
  id               Int      @id @default(autoincrement())
  surahId          Int      @unique
  nameComplex      String?
  nameArabic       String
  nameEnglish      String?
  surahinfo        String?  @db.Text
  revelationOrder  Int?
  revelationPlace  String?
  ayahCount        Int
  bismillahPre     Boolean  @default(true)
  pages            Int[]    @default([])
  ayahs            Ayah[]
  translations     Translation[]
  tafsirs          Tafsir[]
}

model Ayah {
  id                Int             @id @default(autoincrement())
  surah             Surah           @relation(fields: [surahId], references: [id])
  surahId           Int
  ayahNumber        Int
  ayahKey           String          // Format: "1:1"
  pageNumber        Int?
  juzNumber         Int?
  hizbNumber        Int?
  rubElHizbNumber   Int?
  textUthmani       String?         @db.Text
  textImlaei        String?         @db.Text
  ayahInfo          String?         @db.Text
  translations      Translation[]
  tafsirs           Tafsir[]
  createdAt         DateTime        @default(now())

  @@unique([surahId, ayahNumber])
  @@index([ayahKey])
  @@index([juzNumber])
  @@index([pageNumber])
}

model Translation {
  id              Int       @id @default(autoincrement())
  ayah            Ayah?     @relation(fields: [ayahId], references: [id])
  ayahId          Int?
  surah           Surah?    @relation(fields: [surahId], references: [id])
  surahId         Int?
  language_code   String    // ISO language code (e.g., "en")
  translator      String    // Translator/Author name
  text            String    @db.Text // The actual translation text
  createdAt       DateTime  @default(now())

  @@index([language_code])
  @@index([ayahId])
  @@index([surahId])
}

model Tafsir {
  id              Int       @id @default(autoincrement())
  ayah            Ayah?     @relation(fields: [ayahId], references: [id])
  ayahId          Int?
  surah           Surah?    @relation(fields: [surahId], references: [id])
  surahId         Int?
  language_code   String    // ISO language code
  scholar         String?   // Scholar/Author name
  source          String?   // Source name (e.g., "Ibn Kathir")
  text            String    @db.Text // The actual tafsir text
  createdAt       DateTime  @default(now())

  @@index([language_code])
  @@index([ayahId])
  @@index([surahId])
}

model Juz {
  id           Int    @id @default(autoincrement())
  juzNumber    Int    @unique
  ayahMapping  Json?
  firstAyahId  Int?
  lastAyahId   Int?
  AyahsCount   Int
}

model Language {
  id          Int    @id @default(autoincrement())
  name        String
  nativeName  String?
  iso         String @unique
  direction   String @default("ltr")
}
